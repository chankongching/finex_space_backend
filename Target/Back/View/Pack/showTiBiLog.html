<style type="text/css">
    table{

        table-layout:fixed;/* 只有定义了表格的布局算法为fixed，下面td的定义才能起作用。 */
    }
    .wid{
        width:100%;
        word-break:keep-all;/* 不换行 */
        white-space:nowrap;/* 不换行 */
        overflow:hidden;/* 内容超出宽度时隐藏超出部分的内容 */
        text-overflow:ellipsis;/* 当对象内文本溢出时显示省略标记(...) ；需与overflow:hidden;一起使用。*/
    }
</style>
<include file="Public:header"/>
<include file="Public:nav"/>
        <div class="right_col" role="main">
            <!--標題-->
            <div class="page-title">
                <div class="title_left">
                    <h3>提幣列表</h3>
                </div>
            </div>
            <div class="col-md-12 col-sm-12 col-xs-12 nopad">
                <div class="x_panel">
                    <!--筛选条件表單-->
                    <div class="x_title">
                        <h2>篩選條件</h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li>
                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <br>
                        <form id="demo-form2" data-parsley-validate="" class="form-horizontal form-label-left" novalidate="" method="get" action="{:U('Pack/showTiBiLog')}">
                            <!-- <table class="table table-bordered table-condensed"> -->
                                <div class="row">
                                    <!--用戶ID-->
                                    <!--<div class="col-md-2">-->
                                        <!--<label class="control-label col-md-3 col-sm-3 col-xs-6">用戶ID</label>-->
                                        <!--<div class="col-md-9 col-sm-3 col-xs-12">-->
                                            <!--<input type="text" name="uid" value="{$Think.get.uid}" required="required" class="form-control col-md-7 col-xs-12">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--用戶名-->

                                    <div class="col-md-2">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="username">用戶名</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text" id="username" name="username" value="{$Think.get.username}" required="required" class="form-control col-md-7 col-xs-12">
                                        </div>
                                    </div>


                                    <if condition="$agent eq  0 ">
                                        <div class="col-md-2">
                                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="username">邀请码</label>
                                            <div class="col-md-9 col-sm-9 col-xs-12">
                                                <input type="text" id="invite_code" name="invite_code" value="{$Think.get.invite_code}" required="required" class="form-control col-md-7 col-xs-12">
                                            </div>
                                         </div>
                                        <div class="col-md-2">
                                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="username">代理商账号</label>
                                            <div class="col-md-9 col-sm-9 col-xs-12">
                                                <input type="text" id="agent_name" name="agent_name" value="{$Think.get.agent_name}" required="required" class="form-control col-md-7 col-xs-12">
                                            </div>
                                         </div>

                                        <else />
                                        &nbsp;
                                    </if>

                                    <!--錢包地址-->
                                    <!--<div class="col-md-2">-->
                                        <!--<label class="control-label col-md-4 col-sm-4 col-xs-12" for="last-name">錢包地址</label>-->
                                        <!--<div class="col-md-8 col-sm-8 col-xs-12">-->
                                            <!--<input type="text" id="last-name" name="url" value="{$Think.get.url}" required="required" class="form-control col-md-7 col-xs-12">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--選擇查看類型select框-->
                                    <div class="col-md-2">
                                        <label class="control-label col-md-4 col-sm-4 col-xs-12">幣種類型</label>
                                        <div class="col-md-8 col-xs-12">
                                            <select class="form-control" name="currency_id">
                                                <option value="-1">请選擇</option>
                                                <volist name="currency_list" id="vo" key="k">
                                                    <option value="{$key}" <if condition="$Think.get.currency_id eq $key">selected='true'</if>>{$vo}</option>
                                                </volist>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">审核状态</label>
                                        <div class="col-md-7 col-xs-12">
                                            <select class="form-control" name="status">
                                                <volist name="statusArr" id="vo">
                                                    <option value="{$key}" <if condition="$Think.get.status eq $key">selected='true'</if>>{$vo}</option>
                                                </volist>
                                            </select>
                                        </div>
                                    </div>
                                    <!--提交按鈕-->
                                    <div class="col-md-1">
                                        <button type="submit" class="btn btn-success">查找</button>
                                    </div>
                                </tr>
                                </div>
                            <!-- </table> -->
                        </form>
                        提币数据统计：
                        <volist name="bi_data" id="v">
                            {$v['currency_name']}:{$v['num']} &nbsp;
                        </volist>
                    </div>
                </div>
            </div>
            <div class="">
                <div class="clearfix"></div>
                <!--提幣列表-->
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>提幣列表</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <div class="col-sm-6 text-right">
                                        <a class="btn btn-default" href="{:U('Pack/showChongBiLog')}">前往充幣列表</a>
                                    </div>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div id="datatable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                    <div class="row">
                                        <div class="col-sm-12 mb">
                                            <table id="datatable" class="table table-striped table-bordered dataTable no-footer" role="grid" aria-describedby="datatable_info">
                                                <thead>
                                                    <tr role="row">
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">記錄ID</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">用戶ID</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">用戶名</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">幣種名稱</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending">錢包地址</th>
<!--                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">交易哈希</th>-->
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">提幣數量</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending">矿工費</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">實際到賬數量</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">提幣時間</th>
<!--                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">確認時間</th>-->
<!--                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">審核時間</th>-->
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending">狀態</th>
                                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">操作</th>
                                                        <if condition="$AdvancedOperation eq 1">
                                                            <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">高級操作</th>
                                                        </if>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                <volist name="tibi_list" id="vo">
                                                    <tr role="row" class="even">
                                                        <td class="sorting_1 idval wid" title="{$vo['id']}">{$vo['id']}</td>
                                                        <td class="sorting_1 wid" title="{$vo['uid']}">{$vo['uid']}</td>
                                                        <td  data-toggle="modal" data-target="" style= "cursor:pointer" data-card ="{$vo['card_name']}" data-userInfo ="{$vo['om']}_{$vo['phone']}" class = "showInfo wid" title="{$vo['username']}">{$vo['username']}</td>
                                                        <td class="wid">{$vo['currency_name']}</td>
                                                        <td title="{$vo['url']}" class="wid">{$vo['url']}
                                                            <br/>
                                                         <button type="button" data-coin-url="{$vo['url']}"  data-ti-id="{$vo['url']}" class="btn btn-success btn-xs watch_tra" data-toggle="modal" data-target="#addpermission2" >查看</button>
                                                        </td>
<!--                                                        <td class="ti_ids wid" title="{$vo['ti_id']}">
                                                            <if condition="$vo['ti_id']">
                                                            {$vo['ti_id_str']}
                                                            <br/>
                                                            <button type="button" data-coin-url="{$vo['coin_url']}"  data-ti-id="{$vo['ti_id']}" class="btn btn-success btn-xs watch_tra" data-toggle="modal" data-target="#addpermission2" >查看</button>
                                                            </if>
                                                        </td>-->
                                                        <td title="{$vo['num']}" class="wid">{$vo['num']}</td>
                                                        <td title="{$vo['collier_fee']}" class="wid">{$vo['collier_fee']}</td>
                                                        <td title="{$vo['actual']}" class="wid">{$vo['actual']}</td>
                                                        <td class="wid" title="{$vo['add_time']|date='Y-m-d H:i:s',###}">
                                                            <if condition="$vo['add_time'] eq 0">-
                                                                <else/>
                                                                {$vo['add_time']|date='Y-m-d H:i:s',###}
                                                            </if>
                                                        </td>
<!--                                                        <td>-->
<!--                                                            <if condition="$vo['check_time'] eq 0">- -->
<!--                                                                <else/>-->
<!--                                                                {$vo['check_time']|date='Y-m-d H:i:s',###}-->
<!--                                                            </if>-->
<!--                                                        </td>-->
<!--                                                        -->
<!--                                                         <td>-->
<!--                                                            <if condition="$vo['update_time'] eq 0">- -->
<!--                                                                <else/>-->
<!--                                                                {$vo['update_time']|date='Y-m-d H:i:s',###}-->
<!--                                                            </if>-->
<!--                                                        </td>-->
                                                        
                                                        <td title="wid">
                                                            <switch name="vo.status">
                                                                <case value="0">等待審核中</case>
                                                                <case value="1"><span style="color: green;">提幣成功</span></case>
                                                                <case value="-1"><span style="color: red">提幣失敗</span></case>
                                                                <case value="2">等待提出</case>
                                                                <default />
                                                            </switch>
                                                        <td>
                                                            <eq name="vo.status" value='0'>
                                                                <button type="button" class="btn btn-success btn-xs tibi_ok">確認請求</button>
                                                                <button type="button" class="btn btn-danger btn-xs tibi_cancel">取消請求</button>
                                                            </eq>
                                                        </td>
                                                        <if condition="$AdvancedOperation eq 1">
                                                            <td>
                                                                <if condition="$vo['advanced_operate'] eq 1">
                                                                    <!--添加權限按鈕-->
                                                                    <button type="button" class="btn btn-success btn-xs add_hash" data-toggle="modal" data-target="#addpermission" >確認提出</button>
                                                                    <button type="button" class="btn btn-danger btn-xs advance_tibi_cancel">取消提出</button>
                                                                </if>
                                                            </td>
                                                        </if>
                                                    </tr>
                                                </volist>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-5">
                                            <div class="dataTables_info" id="datatable_info" role="status" aria-live="polite"></div>
                                        </div>
                                        {$page}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--提币表單-->  
<div class="modal fade bs-example-modal-lg in" id="addpermission" tabindex="-1" role="dialog" aria-hidden="true" style="margin-top: 15%;">
    <div class="modal-dialog ">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="myModalLabel">添加交易哈希</h4>
            </div>
            <div class="modal-body">
                    <!--權限名-->
                    <div class="form-group">
                        <label class=" col-md-3 col-sm-3 col-xs-12" for="first-name" style="line-height: 30px;">交易哈希值</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input type="hidden" name="id" id='id_value'>
                            <input type="text" name="ti_id" id="ti_id"  required="required" class="form-control col-md-7 col-xs-12">
                        </div>
                    </div>
                    <!--提交按鈕-->
                    <div class="modal-footer">
                        <button type="button" class="btn" style="margin-top: 5%;color: #fff;background-color: #337ab7;border-color: #2e6da4;" id="add_hash_sub">添加</button>
                    </div>
            </div>
        </div>
    </div>
</div>

<!--查看交易哈希-->  
<div class="modal fade bs-example-modal-lg in" id="addpermission2" tabindex="-1" role="dialog" aria-hidden="true" style="margin-top: 15%;">
    <div class="modal-dialog ">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="myModalLabel">交易哈希</h4>
            </div>
            <div class="modal-body">
                    <!--權限名-->
                    <div class="form-group">
                        <label class=" col-md-3 col-sm-3 col-xs-12" for="first-name" style="line-height: 30px;">提币地址</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input type="hidden" name="id" id='id_value_up'/>
                            <input type="hidden" id="coin_url"/>
                            <input type="text"  <if condition="$showAddr eq  0 ">readonly="readonly"</if>  name="ti_id" id="this_ti_id"  required="required" class="form-control col-md-7 col-xs-12">
                        </div>
                    </div>
                    <!--提交按鈕-->
	                    <div class="modal-footer">
<!--	                       <if condition="$showAddr eq 1">
	                        <button type="button" class="btn" style="margin-top: 5%;color: #fff;background-color: #337ab7;border-color: #2e6da4;" id="update_hash_sub">修改</button>
	                        <button type="button" id="watch_blcok_tra" class="btn" style="margin-top: 5%;color: #fff;background-color: #337ab7;border-color: #2e6da4;" >查看</button>
	                       </if>-->
	                    </div>
            </div>
        </div>
    </div>
</div>

<!-- 显示用户电话信息  -->
<div class="modal fade bs-example-modal-lg in" id="showUserInfo" tabindex="-1" role="dialog" aria-hidden="true" style=" padding-right: 17px;margin-top: 15%;">
<div class="modal-dialog ">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                              <h4 class="modal-title" id="myModalLabel2">提幣用戶信息</h4> 
		</div>
		<div   class="form-horizontal form-label-left" >
		<div class="modal-body">
			<div class="form-group">
				<label class="control-label col-md-3 col-sm-3 col-xs-12">用戶名 :</label>
				<div class="col-md-6 col-sm-6 col-xs-12">
					<input type="text"  readonly="readonly" value='' class="form-control col-md-7 col-xs-12 showUser">
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-md-3 col-sm-3 col-xs-12">實名認證名稱 :</label>
				<div class="col-md-6 col-sm-6 col-xs-12">
					<input type="text"  readonly="readonly" value='' class="form-control col-md-7 col-xs-12 showCard">
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">電話號碼 :</label>
				<div class="col-md-6 col-sm-6 col-xs-12">
					<input type="text" readonly="readonly" value = '' class="form-control col-md-7 col-xs-12 showPhone">
				</div>
			</div>									
		</div>
		<!--提交按鈕-->
		<div class="modal-footer">
		</div>
		</div>
	</div>
</div>
</div>

<include file="Public:footer"/>
<script>

    // 查看交易哈希
    $('.watch_tra').click(function(){
        var ti_id    = $(this).attr('data-ti-id');
        var coin_url = $(this).attr('data-coin-url');
        var id_val   = $(this).parent().parent().find('td.idval').text();
        $('#id_value_up').val(id_val);
        $('#this_ti_id').val(ti_id);
        $('#coin_url').val(coin_url);
    });

    // 修改交易哈希
    $('#update_hash_sub').click(function(){
        var id_val = $('#id_value_up').val();
        var ti_id  = $('#this_ti_id').val();
        $.ajax({
            url:"{:U('Back/Pack/upTiId')}",
            data:{'id':id_val, 'ti_id':ti_id},
            type:'post',
            dataType:'json',
            success:function(data){
                layer.msg(data.msg);
                if( data.status == 200 ){
                    setTimeout(function () {
                        window.location.reload();
                    },1000);
                }
            }
        })
    })

    // 查看交易区块的数据
    $('#watch_blcok_tra').click(function(){
        window.open($('#coin_url').val());   
    });

    // 添加交易哈希
    $("#add_hash_sub").click(function(){
        var id_val = $('#id_value').val();
        var ti_id = $('#ti_id').val();
        $.ajax({
            url:"{:U('Back/Pack/successTibi')}",
            data:{'id':id_val, 'ti_id':ti_id},
            type:'post',
            dataType:'json',
            success:function(data){
                layer.msg(data.msg);
                if( data.status == 200 ){
                    setTimeout(function () {
                        window.location.reload();
                    },1000);
                }
            }
        })
    })
    $(".add_hash").click(function(){
        var id_val = $(this).parent().parent().find('td.idval').text();
        $('#id_value').val(id_val);
    })
    $(".tibi_ok").click(function(){
        var id_val = $(this).parent().parent().find('td.idval').text();
        layer.confirm(
            "<span style='color:#fff'>確定通过嗎？</span>",
            {
                title:"*提示",
                btn: ["確定","取消"],
                offset: '300px'
            },
            function(){
                $.ajax({
                    url:"{:U('Back/Pack/editTiBiStatus')}",
                    data:{'id':id_val,'change':'YES'},
                    type:'post',
                    dataType:'json',
                    success:function(data){
                        layer.msg(data.msg);
                        if( data.status == 200 ){
                            setTimeout(function () {
                                window.location.reload();
                            },1000);
                        }
                    }
                })
            });
    })
    $('.advance_tibi_cancel').click(function () {
        tibi_cancel(this);
    })
    $('.tibi_cancel').click(function () {
        tibi_cancel(this);
    })
    $('.advance_tibi_ok').click(function(){
        var id_val = $(this).parent().parent().find('td.idval').text();
        layer.confirm(
            "<span style='color:#fff'>確定通过嗎？</span>",
            {
                title:"*提示",
                btn: ["確定","取23消"],
            },
            function(){
                $.ajax({
                    url:"{:U('Back/Pack/successTibi')}",
                    data:{'id':id_val},
                    type:'post',
                    dataType:'json',
                    success:function(data){
                        layer.msg(data.msg);
                        if( data.status == 200 ){
                            setTimeout(function () {
                                window.location.reload();
                            },1000);
                        }
                    }
                })
            });
    })
    function tibi_cancel(obj) {
        var id_val = $(obj).parent().parent().find('td.idval').text();
        layer.confirm(
            "<span  style='color:#fff;'>確定取消嗎？</span>",
            {
                title:"*提示",
                btn: ["確定","取消"],
                offset: '100px'
            },
            function(){
                $.ajax({
                    url:"{:U('Back/Pack/editTiBiStatus')}",
                    data:{'id':id_val,'change':'NO'},
                    type:'post',
                    dataType:'json',
                    success:function(data){
                        layer.msg(data.msg);
                        if( data.status == 200 ){
                            setTimeout(function () {
                                window.location.reload();
                            },1000);
                        }
                    }
                })
            });
    }
    
    // fix 模态窗展示用户信息 2019年5月30日
    $(function(){
    	$('.showInfo').click(function(){
    		let phone    = $(this).attr('data-userInfo');
    		let name     = $(this).text();
    		let card_name= $(this).attr('data-card');
    		$('.showUser').val(name);
    		$('.showCard').val(card_name);
    		$('.showPhone').val(phone);
    	})
    })
   
   
    
</script>